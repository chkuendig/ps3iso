image: debian/stable

packages:
  - python3
  - python3-virtualenv
  - python3-setuptools
  - genisoimage

sources:
  - https://git.sr.ht/~jmstover/ps3iso

secrets:
  - 2aa81fff-60e1-4458-a093-d7455d124b33

tasks:
  - setup: |
      cd ps3iso
      python3 -m virtualenv -p python3 venv
      source venv/bin/activate
      python -V
      pip install -q -r requirements-dev.txt
  - test: |
      cd ps3iso
      source venv/bin/activate
      make test
  - doc: |
      cd ps3iso
      source venv/bin/activate
      make doc
      [ ! -x ~/.rtd-hook ] || ~/.rtd-hook

